<div class="reports-container">
    <div class="page-header">
        <div>
            <h2 class="section-title">Reports Management</h2>
            <p class="section-subtitle">Review and handle user and post reports.</p>
        </div>
    </div>

    <div class="data-table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Reporter</th>
                    <th>Reported Content</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let report of pagination.paginatedData()"
                    [class.row-resolved]="report.status === 'RESOLVED'">
                    <td>
                        <a [routerLink]="['/profile', report.reporter?.id]" class="user-cell"
                            style="text-decoration: none; display: flex; align-items: center; gap: 0.75rem;">
                            <div class="user-avatar"
                                [style.background-image]="'url(' + (report.reporter?.avatar || 'assets/default-avatar.png') + ')'">
                            </div>
                            <div class="user-info">
                                <p class="user-name" style="color: var(--text-main);">{{ report.reporter?.name ||
                                    'Unknown User' }}</p>
                                <p class="user-handle">{{ report.reporter?.handle || '@user' }}</p>
                            </div>
                        </a>
                    </td>
                    <td>
                        <div *ngIf="report.reportedUser" class="content-cell">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span class="type-tag user">User</span>
                                <a [routerLink]="['/profile', report.reportedUser.id]" class="content-text"
                                    style="text-decoration: none; color: var(--text-main); cursor: pointer;">{{
                                    report.reportedUser.name }}</a>
                                <span *ngIf="report.reportedUser.banned" class="status-indicator banned"
                                    title="Banned User">BANNED</span>
                            </div>
                        </div>
                        <div *ngIf="report.reportedPostId" class="content-cell">
                            <span class="type-tag post">Post</span>
                            <span class="content-text line-clamp-1" (click)="viewPost(report.reportedPostId)"
                                style="cursor: pointer; color: var(--text-main);">{{ report.reportedPostTitle }}</span>
                        </div>
                    </td>
                    <td class="reason-cell">
                        <p class="reason-text">{{ report.reason }}</p>
                    </td>
                    <td>
                        <span class="status-badge" [class]="getStatusClass(report.status)">
                            {{ formatStatus(report.status) | titlecase }}
                        </span>
                    </td>
                    <td>
                        <p class="date-text">{{ report.createdAt | date:'MMM d, yyyy' }}</p>
                    </td>
                    <td class="text-right">
                        <div class="action-buttons">
                            <button *ngIf="report.status === 'PENDING'" class="action-btn review"
                                (click)="updateStatus(report, 'UNDER_REVIEW')" title="Mark as Under Review">
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                            <button *ngIf="report.status !== 'RESOLVED'" class="action-btn resolve"
                                (click)="updateStatus(report, 'RESOLVED')" title="Resolve Report">
                                <span class="material-symbols-outlined">check_circle</span>
                            </button>
                            <button *ngIf="report.status !== 'DISMISSED'" class="action-btn dismiss"
                                (click)="updateStatus(report, 'DISMISSED')" title="Dismiss Report">
                                <span class="material-symbols-outlined">cancel</span>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr *ngIf="dataService.reports().length === 0 && !isLoading()">
                    <td colspan="6" class="empty-cell">No reports found</td>
                </tr>
                <tr *ngIf="isLoading()">
                    <td colspan="6" class="loading-cell">Loading reports...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table-footer">
        <p class="stats">Showing {{ pagination.getPageStart() }} - {{ pagination.getPageEnd() }} of {{
            filteredReports().length }} reports</p>
        <div class="pagination">
            <button class="btn-pager" [disabled]="pagination.currentPage() === 1" (click)="pagination.previousPage()">
                <span class="material-symbols-outlined">chevron_left</span>
                Previous
            </button>
            <span class="page-indicator">Page {{ pagination.currentPage() }} of {{ pagination.totalPages() }}</span>
            <button class="btn-pager" [disabled]="pagination.currentPage() === pagination.totalPages()"
                (click)="pagination.nextPage()">
                Next
                <span class="material-symbols-outlined">chevron_right</span>
            </button>
        </div>
    </div>
</div>