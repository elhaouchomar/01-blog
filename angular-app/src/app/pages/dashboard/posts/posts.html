<div class="page-header">
    <div>
        <h2 class="section-title">Posts Management</h2>
        <p class="section-subtitle">Review, moderate and manage all platform content.</p>
    </div>
    <div class="header-actions">
        <button class="btn btn-export" (click)="exportPosts()">
            <span class="material-symbols-outlined">download</span>
            Export
        </button>
        <button class="btn btn-primary" (click)="modalService.open('create-post')">
            <span class="material-symbols-outlined">add</span>
            Create Post
        </button>
    </div>
</div>

<div class="filters-bar">
    <div class="filter-group">
        <div class="search-box">
            <span class="material-symbols-outlined">search</span>
            <input type="text" placeholder="Filter by author or keyword..." [(ngModel)]="searchQuery"
                (input)="onFilterChange()">
        </div>

        <div class="select-box">
            <span class="material-symbols-outlined icon">filter_list</span>
            <select [(ngModel)]="statusFilter" (change)="onFilterChange()">
                <option value="">All Statuses</option>
                <option value="published">Published</option>
                <option value="flagged">Flagged</option>
                <option value="hidden">Hidden</option>
            </select>
        </div>

        <div class="select-box">
            <span class="material-symbols-outlined icon">sort</span>
            <select [(ngModel)]="sortBy" (change)="onFilterChange()">
                <option value="newest">Newest First</option>
                <option value="most-liked">Most Liked</option>
                <option value="most-reported">Most Reported</option>
            </select>
        </div>
    </div>
</div>

<div class="data-table-container">
    <div class="table-scroll">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-center w-media">Media</th>
                    <th>Content & Author</th>
                    <th>Stats</th>
                    <th>Reports</th>
                    <th>Status</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let post of filteredPosts">
                    <td class="text-center">
                        <div class="post-media"
                            [style.background-image]="'url(' + (post.images?.[0] || 'assets/default-post.png') + ')'">
                        </div>
                    </td>
                    <td>
                        <div class="content-cell">
                            <p class="post-title">{{ post.title }}</p>
                            <div class="post-meta">
                                <div class="author-avatar"
                                    [style.background-image]="'url(' + (post.user?.avatar || 'assets/default-avatar.png') + ')'">
                                </div>
                                <span class="author-name">{{ post.user?.name }}</span>
                                <span class="dot">â€¢</span>
                                <span class="date">{{ post.createdAt | date:'shortTime' }} ago</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="stats-cell">
                            <span class="stat"><span class="material-symbols-outlined">favorite</span> {{
                                post.likes || 0 }}</span>
                            <span class="stat"><span class="material-symbols-outlined">chat_bubble</span> {{
                                post.comments || 0 }}</span>
                        </div>
                    </td>
                    <td>
                        <div *ngIf="post.reportsCount > 0" class="reports-badge">
                            <span class="material-symbols-outlined">warning</span>
                            {{ post.reportsCount }}
                        </div>
                        <span *ngIf="!post.reportsCount" class="no-reports">-</span>
                    </td>
                    <td>
                        <span class="status-badge" [class]="'published'">Published</span>
                    </td>
                    <td class="text-right">
                        <div class="action-buttons">
                            <button class="action-btn" title="Review Content" (click)="reviewPost(post)">
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                            <button class="action-btn delete" title="Delete Post" (click)="deletePost(post)">
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr *ngIf="filteredPosts.length === 0 && !isLoading">
                    <td colspan="6" class="empty-cell">No posts found</td>
                </tr>
                <tr *ngIf="isLoading">
                    <td colspan="6" class="loading-cell">Loading posts...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>