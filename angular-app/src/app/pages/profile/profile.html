<div class="page-container">
    <app-navbar></app-navbar>

    <div class="content-wrapper">
        <!-- Sidebar -->
        <app-sidebar class="sidebar"></app-sidebar>

        <!-- Main Feed -->
        <main class="main-feed" *ngIf="user">
            <!-- Professional Profile Header -->
            <div class="profile-card-premium">
                <!-- Dynamic Cover -->
                <div class="header-cover" [style.background-image]="user.cover ? 'url(' + user.cover + ')' : ''">
                    <div class="cover-overlay" *ngIf="!user.cover"></div>
                </div>

                <div class="header-content">
                    <div class="header-main-row">
                        <!-- Avatar with Status -->
                        <div class="avatar-container-premium">
                            <div class="avatar-main" *ngIf="user.avatar"
                                [style.background-image]="'url(' + user.avatar + ')'">
                            </div>
                            <div class="avatar-main avatar-initials" *ngIf="!user.avatar">
                                {{ getInitials(user.name) }}
                            </div>
                            <div class="status-ring" *ngIf="user.isOnline" title="Online"></div>
                        </div>

                        <!-- Actions -->
                        <div class="header-actions">
                            <ng-container *ngIf="!isOwnProfile; else ownActions">
                                <button class="btn-subscribe-premium" [class.active]="user.isFollowing"
                                    (click)="toggleSubscribe()">
                                    <span class="material-symbols-outlined">{{ user.isFollowing ? 'check' :
                                        'person_add' }}</span>
                                    {{ user.isFollowing ? 'Following' : 'Follow' }}
                                </button>
                                <button class="btn-report-user" (click)="reportUser()" title="Report User">
                                    <span class="material-symbols-outlined">flag</span>
                                </button>
                                <button class="btn-icon-premium" (click)="toggleMenu()">
                                    <span class="material-symbols-outlined">more_horiz</span>
                                </button>
                            </ng-container>
                            <ng-template #ownActions>
                                <button class="btn-edit-premium" routerLink="/settings">
                                    <span class="material-symbols-outlined">settings</span>
                                    <span>Settings</span>
                                </button>
                            </ng-template>
                        </div>
                    </div>

                    <!-- User Details -->
                    <div class="user-identity">
                        <div class="name-badge-row">
                            <h1 class="user-display-name">{{ user.name }}</h1>
                            <span class="verified-badge" *ngIf="isAdmin" title="Admin">
                                <span class="material-symbols-outlined">verified</span>
                            </span>
                        </div>
                        <p class="user-handle-premium">@{{ user.handle }}</p>
                    </div>

                    <!-- Professional Bio -->
                    <p class="user-bio-premium" [class.empty]="!user.bio">
                        {{ user.bio || 'Professional developer and community member. Passionate about building great
                        software.' }}
                    </p>

                    <!-- Stats Dashboard -->
                    <div class="stats-dashboard" *ngIf="user.stats">
                        <div class="stat-box">
                            <span class="stat-count">{{ user.stats.posts }}</span>
                            <span class="stat-name">Articles</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-box clickable">
                            <span class="stat-count">{{ user.stats.followers > 1000 ?
                                (user.stats.followers/1000).toFixed(1) + 'k' : user.stats.followers }}</span>
                            <span class="stat-name">Subscribers</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-box clickable">
                            <span class="stat-count">{{ user.stats.following }}</span>
                            <span class="stat-name">Subscriptions</span>
                        </div>
                    </div>
                </div>

                <!-- Navigation Tabs -->
                <div class="profile-tabs-premium">
                    <button class="tab-btn" [class.active]="activeTab === 'Posts'" (click)="setTab('Posts')">
                        <span class="material-symbols-outlined tab-icon">article</span>
                        Posts
                    </button>
                    <button class="tab-btn" [class.active]="activeTab === 'About'" (click)="setTab('About')">
                        <span class="material-symbols-outlined tab-icon">info</span>
                        About
                    </button>
                    <button class="tab-btn" [class.active]="activeTab === 'Media'" (click)="setTab('Media')">
                        <span class="material-symbols-outlined tab-icon">image</span>
                        Media
                    </button>
                    <button class="tab-btn" [class.active]="activeTab === 'Likes'" (click)="setTab('Likes')">
                        <span class="material-symbols-outlined tab-icon">favorite</span>
                        Likes
                    </button>
                </div>
            </div>

            <!-- Feed Section -->
            <div class="profile-feed-container" *ngIf="activeTab === 'Posts'">
                <div class="feed-header-row">
                    <h2 class="feed-title">Recent Posts</h2>
                    <div class="feed-filters">
                        <span class="filter-label">Sort by:</span>
                        <select class="feed-select">
                            <option>Latest</option>
                            <option>Popular</option>
                        </select>
                    </div>
                </div>

                <div class="post-list" style="margin-top: 1rem;">
                    <div class="loading-state-premium" *ngIf="isLoading">
                        <div class="shimmer-card"></div>
                        <p>Loading your latest updates...</p>
                    </div>

                    <div class="empty-state-premium" *ngIf="!isLoading && posts.length === 0">
                        <div class="empty-icon-box">
                            <span class="material-symbols-outlined">post_add</span>
                        </div>
                        <h3>No posts to show yet</h3>
                        <p>Share your first article with the community!</p>
                    </div>

                    <app-post-card *ngFor="let post of posts" [post]="post"></app-post-card>
                </div>
            </div>

            <!-- About Section Placeholder -->
            <div class="profile-card-premium" style="padding: 2rem;" *ngIf="activeTab === 'About'">
                <h2 class="feed-title" style="margin-bottom: 1.5rem;">About {{ user.name }}</h2>
                <div class="about-grid">
                    <div class="about-item">
                        <span class="material-symbols-outlined">badge</span>
                        <div>
                            <p class="stat-name">Full Name</p>
                            <p class="user-handle-premium" style="color: var(--text-main);">{{ user.name }}</p>
                        </div>
                    </div>
                    <div class="about-item" style="margin-top: 1.5rem;">
                        <span class="material-symbols-outlined">mail</span>
                        <div>
                            <p class="stat-name">Contact Handle</p>
                            <p class="user-handle-premium" style="color: var(--text-main);">@{{ user.handle }}</p>
                        </div>
                    </div>
                    <div class="about-item" style="margin-top: 1.5rem;">
                        <span class="material-symbols-outlined">calendar_today</span>
                        <div>
                            <p class="stat-name">Member Since</p>
                            <p class="user-handle-premium" style="color: var(--text-main);">{{ (user.createdAt |
                                date:'longDate') || 'January 2024' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Media Section Placeholder -->
            <div class="empty-state-premium" style="margin-top: 1rem;" *ngIf="activeTab === 'Media'">
                <div class="empty-icon-box">
                    <span class="material-symbols-outlined">perm_media</span>
                </div>
                <h3>No media content found</h3>
                <p>This user hasn't shared any images or videos yet.</p>
            </div>

            <!-- Likes Section Placeholder -->
            <div class="empty-state-premium" style="margin-top: 1rem;" *ngIf="activeTab === 'Likes'">
                <div class="empty-icon-box">
                    <span class="material-symbols-outlined">favorite_border</span>
                </div>
                <h3>Nothing liked yet</h3>
                <p>Private liked posts or no likes recorded.</p>
            </div>
        </main>

        <!-- Right Sidebar -->
        <app-right-sidebar class="sidebar"></app-right-sidebar>
    </div>
</div>