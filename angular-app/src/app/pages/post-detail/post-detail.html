<div class="page-container">
    <app-navbar></app-navbar>

    <div class="content-wrapper" *ngIf="post() as currentPost">
        <app-sidebar class="sidebar"></app-sidebar>

        <main class="main-feed">
            <div class="back-nav">
                <button type="button" class="btn-back-premium" (click)="goBack()">
                    <span class="material-symbols-outlined">arrow_back</span>
                    <span>Back to feed</span>
                </button>
            </div>

            <article class="post-detail-card">
                <div class="post-header-premium">
                    <div class="post-author-row">
                        <div class="post-avatar-large"
                            [style.background-image]="'url(' + (currentPost.user.avatar || 'assets/default-avatar.png') + ')'">
                        </div>
                        <div class="post-author-meta">
                            <a [routerLink]="['/profile', currentPost.user.id]" class="author-name-link">{{
                                currentPost.user.name }}</a>
                            <p class="post-timestamp">{{ currentPost.user.role || 'Member' }} â€¢ {{
                                (currentPost.createdAt || currentPost.time) | date:'medium' }}</p>
                        </div>
                    </div>
                    <button class="btn-more">
                        <span class="material-symbols-outlined">more_horiz</span>
                    </button>
                </div>

                <div class="post-body-premium">
                    <h1 class="post-full-title" *ngIf="currentPost.title">{{ currentPost.title }}</h1>
                    <div class="post-full-text">{{ currentPost.fullContent || currentPost.content }}</div>
                </div>

                <div class="post-media-grid" *ngIf="(currentPost.images && currentPost.images.length > 0)">
                    <div *ngFor="let mediaUrl of currentPost.images" class="media-item-full">
                        <img [src]="mediaUrl" alt="Post content" class="img-responsive">
                    </div>
                </div>

                <div class="post-footer-actions">
                    <button type="button" class="action-btn-large" [class.active]="currentPost.isLiked"
                        (click)="toggleLike()">
                        <span class="material-symbols-outlined" [class.filled]="currentPost.isLiked">favorite</span>
                        <span class="count-label">{{ currentPost.likes }} Likes</span>
                    </button>
                    <button type="button" class="action-btn-large">
                        <span class="material-symbols-outlined">share</span>
                        <span class="count-label">Share</span>
                    </button>
                </div>
            </article>

            <section class="comments-section-premium">
                <div class="section-heading">
                    <h3>Discussion <span>({{ comments().length }})</span></h3>
                </div>

                <div class="comment-input-area" *ngIf="dataService.currentUser()">
                    <div class="user-avatar-mini"
                        [style.background-image]="'url(' + (dataService.currentUser()?.avatar || 'assets/default-avatar.png') + ')'">
                    </div>
                    <div class="input-container-premium">
                        <textarea [(ngModel)]="commentText" placeholder="Join the discussion..." rows="3"></textarea>
                        <div class="input-actions-premium">
                            <button type="button" class="btn-submit-premium" (click)="submitComment()"
                                [disabled]="!commentText.trim()">Post Comment</button>
                        </div>
                    </div>
                </div>

                <div class="comments-list-premium">
                    <div class="comment-item-premium" *ngFor="let comment of comments()">
                        <div class="comment-avatar-mini"
                            [style.background-image]="'url(' + (comment.user.avatar || 'assets/default-avatar.png') + ')'">
                        </div>
                        <div class="comment-content-main">
                            <div class="comment-user-row">
                                <span class="comment-username">{{ comment.user.name }}</span>
                                <span class="comment-date">{{ comment.time }}</span>
                            </div>
                            <p class="comment-body">{{ comment.content }}</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <app-right-sidebar class="sidebar"></app-right-sidebar>
    </div>

    <div class="loading-full-page" *ngIf="!post()">
        <div class="shimmer-post"></div>
        <p>Enhancing details...</p>
    </div>
</div>