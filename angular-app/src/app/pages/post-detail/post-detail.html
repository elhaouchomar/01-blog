<div class="page-container">
    <app-navbar></app-navbar>

    <div class="content-wrapper" *ngIf="post() as currentPost">
        <!-- Sidebar -->
        <app-sidebar class="sidebar"></app-sidebar>

        <!-- Main Feed -->
        <main class="main-feed">
            <!-- Back Button -->
            <div class="back-button-wrapper" style="margin-bottom: 1rem;">
                <button type="button" class="back-button" (click)="goBack()"
                    style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--primary); font-weight: 600;">
                    <span class="material-symbols-outlined">arrow_back</span>
                    <span>Back</span>
                </button>
            </div>

            <article class="post-card">
                <!-- Post Header -->
                <div class="post-header">
                    <div class="post-author">
                        <div class="post-avatar"
                            [style.background-image]="'url(' + (currentPost.user.avatar || 'assets/default-avatar.png') + ')'">
                        </div>
                        <div class="post-author-info">
                            <div class="author-row">
                                <a [routerLink]="['/profile', currentPost.user.id]" class="post-author-name">{{
                                    currentPost.user.name }}</a>
                                <span class="post-author-handle">{{ currentPost.user.handle }}</span>
                            </div>
                            <p class="post-meta">{{ currentPost.user.role || 'User' }} â€¢ {{ (currentPost.createdAt ||
                                currentPost.time) | date:'short' }}</p>
                        </div>
                    </div>
                </div>

                <!-- Post Content -->
                <div class="post-content">
                    <h1 class="post-title" *ngIf="currentPost.title" style="font-size: 1.5rem; margin: 1rem 0;">{{
                        currentPost.title }}</h1>
                    <p class="post-text">{{ currentPost.fullContent || currentPost.content }}</p>
                </div>

                <!-- Media Content -->
                <div class="post-media"
                    *ngIf="(currentPost.images && currentPost.images.length > 0) || currentPost.video"
                    style="margin-top: 1rem;">
                    <div *ngFor="let mediaUrl of currentPost.images" style="margin-bottom: 0.5rem;">
                        <img [src]="mediaUrl" style="width: 100%; border-radius: 0.75rem; object-fit: cover;"
                            alt="Post media">
                    </div>
                </div>

                <!-- Actions -->
                <div class="post-actions"
                    style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--gray-100);">
                    <div class="post-action-group" style="display: flex; gap: 1.5rem;">
                        <button type="button" class="post-action-btn" [class.liked]="currentPost.isLiked"
                            (click)="toggleLike()"
                            style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--text-secondary);">
                            <span class="material-symbols-outlined" [class.filled]="currentPost.isLiked">favorite</span>
                            <span>{{ currentPost.likes }}</span>
                        </button>
                    </div>
                </div>
            </article>

            <!-- Comments Section -->
            <div class="comments-section"
                style="margin-top: 1.5rem; background: var(--surface-light); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid var(--gray-100);">
                <h2 class="comments-title" style="font-size: 1.1rem; margin-bottom: 1.5rem;">Comments ({{
                    comments().length }})</h2>

                <!-- Comment Input -->
                <div class="comment-input-container" *ngIf="currentUser"
                    style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <div class="comment-avatar"
                        [style.background-image]="'url(' + (currentUser.avatar || 'assets/default-avatar.png') + ')'"
                        style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background-size: cover; flex-shrink: 0;">
                    </div>
                    <div class="comment-input-wrapper" style="flex: 1;">
                        <textarea [(ngModel)]="commentText" placeholder="Write a comment..." class="input-field"
                            rows="3" style="width: 100%; margin-bottom: 0.5rem; resize: none;"></textarea>
                        <button type="button" class="btn btn-primary" (click)="submitComment()"
                            [disabled]="!commentText.trim()">Comment</button>
                    </div>
                </div>

                <div class="comments-list">
                    <div class="comment-item" *ngFor="let comment of comments()"
                        style="margin-bottom: 1.5rem; display: flex; gap: 1rem;">
                        <div class="comment-avatar"
                            [style.background-image]="'url(' + (comment.user.avatar || 'assets/default-avatar.png') + ')'"
                            style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background-size: cover; flex-shrink: 0;">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header" style="margin-bottom: 0.25rem;">
                                <span style="font-weight: 700; font-size: 0.875rem;">{{ comment.user.name }}</span>
                                <span style="color: var(--text-secondary); font-size: 0.75rem; margin-left: 0.5rem;">{{
                                    comment.time }}</span>
                            </div>
                            <p style="font-size: 0.875rem; line-height: 1.5;">{{ comment.content }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Side -->
        <aside class="sidebar">
            <app-right-sidebar></app-right-sidebar>
        </aside>
    </div>

    <div class="loading-container" *ngIf="!post()" style="text-align: center; padding: 4rem;">
        <p>Loading post details...</p>
    </div>
</div>